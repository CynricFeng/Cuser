from cuser import SerAction
import time


def GetPosition(tem):
    ucBase = int(tem / 16)
    ucOffset = tem % 16

    if ucBase == 1:
        ucBase = 0
    elif ucBase == 2:
        ucBase = 14
    elif ucBase == 3:
        ucBase = 28

    ucPosition = ucBase + (ucOffset - 1) * 2
    return ucPosition


def play_music(arrMusic, ser):
    i = 0
    ucRhythmTmp = 0
    ser.buzzer_start()
    while (True):
        ucNoteTmp = arrMusic[i]
        if ucNoteTmp == 0x00:
            i = 0
            time.sleep(0.1)

        elif ucNoteTmp == 0xff:
            i = i + 2
            ser.buzzer_stop()
            time.sleep(0.1)
            ser.buzzer_start()


        else:
            tem = GetPosition(arrMusic[i])
            i += 1
            ser.buzzer_tone_music(tem)
            ucRhythmTmp = arrMusic[i]
            i += 1

        ser.buzzer_start()
        time.sleep(ucRhythmTmp * 0.028)
        ser.buzzer_stop()


arrMusic = [
    0x15, 0x20, 0x21, 0x10,
    0x22, 0x10, 0x23, 0x18,
    0x24, 0x08, 0x23, 0x10,
    0x21, 0x10, 0x22, 0x20,
    0x21, 0x10, 0x16, 0x10,
    0x21, 0x40, 0x15, 0x20,
    0x21, 0x10, 0x22, 0x10,
    0x23, 0x10, 0x23, 0x08,
    0x24, 0x08, 0x25, 0x10,
    0x21, 0x10, 0x24, 0x18,
    0x23, 0x08, 0x25, 0x10,
    0x22, 0x08, 0x23, 0x08,
    0x23, 0x08, 0x22, 0x08,
    0x22, 0x30, 0x23, 0x20,
    0x25, 0x10, 0x31, 0x10,
    0x27, 0x18, 0x26, 0x08,
    0x26, 0x20, 0x25, 0x10,
    0x25, 0x08, 0x26, 0x08,
    0x27, 0x10, 0x26, 0x08,
    0x25, 0x08, 0x23, 0x40,
    0x24, 0x18, 0x24, 0x08,
    0x25, 0x10, 0x26, 0x10,
    0x25, 0x10, 0x24, 0x08,
    0x23, 0x08, 0x22, 0x20,
    0x17, 0x10, 0x17, 0x08,
    0x16, 0x08, 0x15, 0x10,
    0x16, 0x10, 0x21, 0x40,
    0x00, 0x00
]

ser = SerAction()
ser.connection()
play_music(arrMusic, ser)
